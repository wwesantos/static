const get=function(t){return document.querySelector(t)},initialValue=get("#valor-inicial"),monthlyValue=get("#valor-mensal"),milhao=get("#milhao"),interestRange=get("#taxa-juros"),interestValue=get("#juros-span"),evolution=get("#evolution"),canva=get("#dataviz"),MILLION=1e6,dateOptions={year:"numeric",month:"long"},currencyOptions={style:"currency",currency:"BRL"},locale=d3.formatLocale({decimal:",",thousands:".",grouping:[3],currency:["R$"," "]}),fformat=locale.format("$,"),getTime=function(t){const e=Math.trunc(t/12),a=t%12;let n=a>0?"":" Inicial ";return 1==e?n=e+" ano ":e>1&&(n=e+" anos "),e>0&&a>0&&(n+="e "),1==a?n+=a+" mÃªs ":a>1&&(n+=a+" meses "),n},addRows=function(t){t.forEach(function(t){let e=document.createElement("tr");e.innerHTML="<td>"+getTime(t.month)+"</td><td>"+t.fortatedDate+"</td><td>"+t.formatedValue+"</td>",evolution.appendChild(e)})},plotBars=function(t){const e=Math.min(document.getElementById("d3-js-container").clientWidth,650),a={top:30,right:20,bottom:90,left:85},n=e-a.left-a.right,r=e-a.top-a.bottom-.2*e;var o=d3.select("#dataviz").append("svg").attr("width",n+a.left+a.right).attr("height",r+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")"),i=d3.scaleBand().range([0,n]).domain(t.map(function(t){return getTime(t.month)})).padding(.2);o.append("g").attr("transform","translate(0,"+r+")").call(d3.axisBottom(i)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var l=d3.scaleLinear().domain([0,MILLION]).range([r,0]);o.append("g").attr("class","d3js-grid").call(d3.axisLeft(l).ticks(5).tickSize(-n).tickFormat("")),o.append("g").call(d3.axisLeft(l).tickFormat(function(t){return fformat(t)})),o.selectAll("mybar").data(t).enter().append("rect").attr("x",function(t){return i(getTime(t.month))}).attr("y",function(t){return l(t.value)}).attr("width",i.bandwidth()).attr("height",function(t){return r-l(t.value)}).attr("fill","#69b3a2")};get("#form-inputs").addEventListener("focusin",function(t){0==t.target.value&&("valor-inicial"==t.target.id&&(initialValue.value=""),"valor-mensal"==t.target.id&&(monthlyValue.value=""))}),get("#form-inputs").addEventListener("input",function(t){"taxa-juros"==t.target.id&&(interestValue.innerHTML=t.target.value+"%");const e=Number(interestRange.value),a=Number(initialValue.value.replace(".","")),n=Number(monthlyValue.value.replace(".",""));if(milhao.value="",evolution.innerHTML="",canva.innerHTML="",n>9||a>99){const t=(Number(e)/100+1)**(1/12);let r=0,o=a;for(;o<MILLION;)r++,o=o*t+n;if(r>0){let e=r>10?Math.trunc(r/10):1,o=a,i=0;const l=[];for(;i<=r;){if(i%e==0&&e<r-i||r==i){const t=new Date,e=new Date(t.setMonth(t.getMonth()+i)),a=new Intl.DateTimeFormat("pt-BR",dateOptions).format(e),n=new Intl.NumberFormat("pt-BR",currencyOptions).format(o);l.push({fortatedDate:a,formatedValue:n,value:o,month:i})}o=o*t+n,i++}plotBars(l),addRows(l)}const i=new Date,l=new Date(i.setMonth(i.getMonth()+r));milhao.value=new Intl.DateTimeFormat("pt-BR",dateOptions).format(l)}});